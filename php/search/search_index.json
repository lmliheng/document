{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"index.html","title":"\u4e3b\u9875","text":""},{"location":"index.html#hello","title":"Hello,\u200b\u6211\u200b\u662f\u200b\u6052","text":""},{"location":"build.html","title":"\u90e8\u7f72","text":""},{"location":"build.html#linuxphpnginx","title":"linux\u200b\u90e8\u7f72\u200bPHP(\u200b\u4f7f\u7528\u200bnginx)","text":""},{"location":"build.html#nginx","title":"nginx\u200b\u914d\u7f6e","text":"<p>nginx\u200b\u7684\u200bserver\u200b\u5757\u200b\u914d\u7f6e\u200b <pre><code>   server {\n            listen  80;\n            server_name php.liheng.work; # \u200b\u66f4\u200b\u6539\u4e3a\u200b\u4f60\u200b\u81ea\u5df1\u200b\u7684\u200b\u57df\u540d\u200b\n\n            root /home/site/navagsnsite; # \u200b\u66f4\u200b\u6539\u4e3a\u200b\u4f60\u200b\u9879\u76ee\u200b\u7684\u200b\u6839\u76ee\u5f55\u200b\n\n            index index.php index.html index.htm;\n\n      # \u200b\u9759\u6001\u200b\u6587\u4ef6\u200b\u5904\u7406\u200b\n        location / {\n                try_files $uri $uri/ =404; }\n\n         # PHP \u200b\u8bf7\u6c42\u200b\u5904\u7406\u200b\n         location ~ \\.php$ {\n\n            fastcgi_pass 127.0.0.1:9000;\n            fastcgi_index index.php;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            include fastcgi_params;\n                    }\n                  # \u200b\u9519\u8bef\u200b\u9875\u9762\u200b\n }\n</code></pre></p>"},{"location":"build.html#php-pfm","title":"\u4f7f\u7528\u200bPHP-PFM","text":"<p>\u200b\u786e\u4fdd\u200bPHP-FPM\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200blisten\u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u6b63\u786e\u200b\u7684\u200b\u5730\u5740\u200b\u548c\u200b\u7aef\u53e3\u200b\u3002\u200b\u7f16\u8f91\u200bPHP-FPM\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff08\u200b\u901a\u5e38\u200b\u4f4d\u4e8e\u200b/etc/php-fpm.d/www.conf \u200b\u6216\u200b /etc/php/7.4/fpm/pool.d/www.conf\uff09\uff0c\u200b\u627e\u5230\u200blisten\u200b\u6307\u4ee4\u200b <pre><code>listen = 127.0.0.1:9000\n</code></pre> \u200b\u4f7f\u200bPHP-FPM\u200b\u76d1\u542c\u200bIP\u200b\u5730\u5740\u200b127.0.0.1\u200b\u4e0a\u200b\u7684\u200b\u7aef\u53e3\u200b9000,\u200b\u8bf7\u200b\u786e\u4fdd\u200b\u8fd9\u200b\u4e0e\u200bNginx\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200bfastcgi_pass\u200b\u6307\u4ee4\u200b\u76f8\u5339\u914d\u200b</p> <p>\u200b\u91cd\u542f\u200bPHP-FPM\u200b\u670d\u52a1\u200b\u4ee5\u200b\u5e94\u7528\u200b\u66f4\u6539\u200b\uff1a <pre><code>sudo systemctl restart php-fpm\n</code></pre> \u200b\u786e\u4fdd\u200bPHP-FPM\u200b\u670d\u52a1\u200b\u5df2\u200b\u542f\u52a8\u200b\u5e76\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\uff1a <pre><code>sudo systemctl status php-fpm\n</code></pre></p>"},{"location":"code.html","title":"\u4ee3\u7801\u200b\u7247\u6bb5","text":""},{"location":"code.html#_1","title":"\u54cd\u5e94\u200b\u6587\u4ef6","text":"<p><pre><code>&lt;?php\n\nfunction checkSignature()\n{\n    $signature = $_GET[\"signature\"];\n    $timestamp = $_GET[\"timestamp\"];\n    $nonce = $_GET[\"nonce\"];\n\n    $token = TOKEN;\n    $tmpArr = array(TOKEN, $timestamp, $nonce);\n    sort($tmpArr, SORT_STRING);\n    $tmpStr = implode($tmpArr);\n    $tmpStr = sha1($tmpStr);\n\n    if ($tmpStr == $signature) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nif (checkSignature()) {\n    echo $_GET[\"echostr\"];\n} else {\n    echo \"error\";\n}\n?&gt;\n</code></pre> \u200b\u4f7f\u7528\u200bweb\u200b\u670d\u52a1\u5668\u200b\u90e8\u7f72\u200bphp\uff0c\u200b\u9a8c\u8bc1\u200bURL\u200b\u6709\u6548\u6027\u200b\u6210\u529f\u200b\u540e\u200b\u5373\u200b\u670d\u52a1\u5668\u200b\u914d\u7f6e\u200b\u751f\u6548\u200b\uff0c\u200b\u5373\u200b\u63a5\u5165\u200b\u751f\u6548\u200b</p>"},{"location":"dev.html","title":"\u5f00\u53d1\u200b\u7b14\u8bb0","text":"<p>\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200bPHP\u200b\u6587\u4ef6\u200b\uff08\u200b\u4f8b\u5982\u200blogin_with_wechat.php\uff09\uff0c\u200b\u7528\u4e8e\u200b\u5904\u7406\u200b\u4f7f\u7528\u200b\u5fae\u4fe1\u200b\u516c\u4f17\u200b\u53f7\u200b\u767b\u5f55\u200b\u7f51\u9875\u200b\u7684\u200b\u8bf7\u6c42\u200b <pre><code>login_with_wechat.php\n\n&lt;?php\n// \u200b\u83b7\u53d6\u200baccess_token\u200b\u7684\u200bURL\n$url = \"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET\";\n\n// \u200b\u53d1\u9001\u200bGET\u200b\u8bf7\u6c42\u200b\u83b7\u53d6\u200baccess_token\n$ch = curl_init();\ncurl_setopt($ch, CURLOPT_URL, $url);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n$response = curl_exec($ch);\ncurl_close($ch);\n\n// \u200b\u89e3\u6790\u200b\u54cd\u5e94\u200b\n$result = json_decode($response, true);\n\n// \u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u83b7\u53d6\u200b\u5230\u200baccess_token\nif (isset($result['access_token'])) {\n    // \u200b\u5c06\u200baccess_token\u200b\u548c\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\u5b58\u50a8\u200b\u5230\u200b\u6587\u4ef6\u200b\u4e2d\u200b\n    file_put_contents('access_token.json', json_encode($result));\n    echo \"Access token saved successfully.\";\n} else {\n    echo \"Failed to get access token.\";\n}\n</code></pre> \u200b\u8bf7\u200b\u5c06\u200bAPPID\u200b\u548c\u200bAPPSECRET\u200b\u66ff\u6362\u200b\u4e3a\u200b\u60a8\u200b\u7684\u200b\u5b9e\u9645\u200b\u503c\u200b\u3002</p> <p>\u200b\u8981\u200b\u4f7f\u7528\u200b\u6b64\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8bf7\u200b\u5c06\u200b\u5176\u200b\u4fdd\u5b58\u200b\u4e3a\u200b<code>login_with_wechat.php</code>\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5e76\u200b\u786e\u4fdd\u200b\u5df2\u200b\u5b89\u88c5\u200bPHP\u200b\u548c\u200bcURL\u200b\u6269\u5c55\u200b\u3002\u200b\u7136\u540e\u200b\uff0c\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8fd0\u884c\u200bphp login_with_wechat.php\u200b\u547d\u4ee4\u200b\u6765\u200b\u83b7\u53d6\u200baccess_token\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u4fdd\u5b58\u200b\u5230\u200baccess_token.json\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5728\u200b\u60a8\u200b\u7684\u200bindex.php\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u4f7f\u7528\u200b<code>access_token</code>\uff0c\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u4ece\u200b<code>access_token.json</code>\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u5b83\u200b\u3002\u200b\u5728\u200bindex.php\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u6765\u200b\u83b7\u53d6\u200baccess_token\uff1a <pre><code>$access_token_data = json_decode(file_get_contents('access_token.json'), true);\n$access_token = $access_token_data['access_token'];\n</code></pre> \u200b\u7136\u540e\u200b\uff0c\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8c03\u7528\u200b\u5fae\u4fe1\u200b\u516c\u4f17\u200b\u53f7\u200bAPI\u200b\u65f6\u200b\u4f7f\u7528\u200b$access_token\u200b\u53d8\u91cf\u200b\u3002\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u60a8\u200b\u9700\u8981\u200b\u786e\u4fdd\u200baccess_token.json\u200b\u6587\u4ef6\u200b\u5b58\u5728\u200b\u5e76\u200b\u5305\u542b\u200b\u6709\u6548\u200b\u7684\u200baccess_token\u200b\u6570\u636e\u200b\u3002\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8ba1\u5212\u200b\u4efb\u52a1\u200b\uff08\u200b\u5982\u200bcron job\uff09\u200b\u5b9a\u671f\u200b\u8fd0\u884c\u200blogin_with_wechat.php\u200b\u811a\u672c\u200b\u4ee5\u200b\u66f4\u65b0\u200baccess_token\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5728\u200bindex.php\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5904\u7406\u200b\u5fae\u4fe1\u200b\u516c\u4f17\u200b\u53f7\u200b\u767b\u5f55\u200b\u3002\u200b\u5728\u200bwechatCallBackapiTest\u200b\u7c7b\u4e2d\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200bloginWithWechat\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a <pre><code>public function loginWithWechat($code)\n{\n    // \u200b\u83b7\u53d6\u200baccess_token\u200b\u548c\u200bopenid\n    $url = \"https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=APPSECRET&amp;code=$code&amp;grant_type=authorization_code\";\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, $url);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n    $response = curl_exec($ch);\n    curl_close($ch);\n    $result = json_decode($response, true);\n\n    if (isset($result['access_token']) &amp;&amp; isset($result['openid'])) {\n        $access_token = $result['access_token'];\n        $openid = $result['openid'];\n\n        // \u200b\u83b7\u53d6\u200b\u7528\u6237\u200b\u4fe1\u606f\u200b\n        $url = \"https://api.weixin.qq.com/sns/userinfo?access_token=$access_token&amp;openid=$openid&amp;lang=zh_CN\";\n        $ch = curl_init();\n        curl_setopt($ch, CURLOPT_URL, $url);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        $response = curl_exec($ch);\n        curl_close($ch);\n        $user_info = json_decode($response, true);\n\n        if (isset($user_info['nickname'])) {\n            // \u200b\u767b\u5f55\u200b\u6210\u529f\u200b\uff0c\u200b\u5904\u7406\u200b\u7528\u6237\u200b\u4fe1\u606f\u200b\n            // ...\n        } else {\n            // \u200b\u767b\u5f55\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fd4\u56de\u200b\u9519\u8bef\u4fe1\u606f\u200b\n            return \"Failed to get user info.\";\n        }\n    } else {\n        return \"Failed to get access token and openid.\";\n    }\n}\n</code></pre> \u200b\u8bf7\u200b\u5c06\u200bAPPID\u200b\u548c\u200bAPPSECRET\u200b\u66ff\u6362\u200b\u4e3a\u200b\u60a8\u200b\u7684\u200b\u5b9e\u9645\u200b\u503c\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u5728\u200bindex.php\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u60a8\u200b\u9700\u8981\u200b\u5904\u7406\u200b\u7528\u6237\u200b\u4ece\u200b\u5fae\u4fe1\u200b\u516c\u4f17\u200b\u53f7\u200b\u767b\u5f55\u200b\u540e\u200b\u8fd4\u56de\u200b\u7684\u200bcode\u200b\u53c2\u6570\u200b\u3002\u200b\u5728\u200bindex.php\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\uff1a <pre><code>if (isset($_GET['code'])) {\n    $code = $_GET['code'];\n    $wechat = new wechatCallBackapiTest();\n    $result = $wechat-&gt;loginWithWechat($code);\n    echo $result;\n}\n</code></pre> \u200b\u8fd9\u200b\u5c06\u200b\u5904\u7406\u200b\u4ece\u200b\u5fae\u4fe1\u200b\u516c\u4f17\u200b\u53f7\u200b\u767b\u5f55\u200b\u540e\u200b\u8fd4\u56de\u200b\u7684\u200bcode\u200b\u53c2\u6570\u200b\uff0c\u200b\u5e76\u200b\u8c03\u7528\u200bloginWithWechat\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5982\u679c\u200b\u767b\u5f55\u200b\u6210\u529f\u200b\uff0c\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u5728\u200bloginWithWechat\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u5904\u7406\u200b\u7528\u6237\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5c06\u200b\u5176\u200b\u5b58\u50a8\u200b\u5230\u200b\u6570\u636e\u5e93\u200b\u6216\u4f1a\u200b\u8bdd\u200b\u4e2d\u200b\u3002</p>"}]}